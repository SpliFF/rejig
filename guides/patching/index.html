
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Programmatic Python refactoring with LibCST">
      
      
      
        <link rel="canonical" href="https://github.com/SpliFF/rejig/guides/patching/">
      
      
        <link rel="prev" href="../transactions/">
      
      
        <link rel="next" href="../frameworks/django/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Patching - Rejig</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#patching" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Rejig" class="md-header__button md-logo" aria-label="Rejig" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rejig
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Patching
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/SpliFF/rejig" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SpliFF/rejig
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Rejig" class="md-nav__button md-logo" aria-label="Rejig" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rejig
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SpliFF/rejig" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SpliFF/rejig
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Finding & Modifying Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Finding & Modifying Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finding-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Finding Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modifying-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Modifying Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../line-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Line Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Quality
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Quality
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Transformation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Transformation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Import Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../type-hints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Type Hints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docstrings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docstrings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config Files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Patching
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Patching
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parsing Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parsing Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-a-string" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a String
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supported Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspecting-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspecting Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patch-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        Patch Properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-by-file-type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtering by File Type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigating-to-files-and-hunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating to Files and Hunks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Applying Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dry-run-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dry Run Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-individual-files-or-hunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Apply Individual Files or Hunks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generating Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-a-single-result" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a Single Result
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-batchresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a BatchResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a Transaction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saving Patches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reversing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reversing Patches
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-to-rejig-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Converting to Rejig Code
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Converting to Rejig Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smart-mode-vs-line-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Smart Mode vs Line Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-variable-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Variable Name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-python-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generating Python Scripts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Python Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saving Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#script-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generated-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Generated Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analyzing Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyzing Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detected-operation-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detected Operation Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#review-patches-before-applying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review Patches Before Applying
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-undo-patches-for-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Undo Patches for Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-code-changes-to-another-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migrate Code Changes to Another Branch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-patch-to-current-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compare Patch to Current State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-patches-for-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate Patches for CI/CD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Framework-Specific
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Framework-Specific
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frameworks/django/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Django
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frameworks/flask/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Flask
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frameworks/fastapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FastAPI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples & Recipes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples & Recipes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/refactoring-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Refactoring Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/codemod-recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Codemod Recipes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/optimization-recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optimization Recipes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/analysis-recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analysis Recipes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/security-recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Recipes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/rejig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rejig Class
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/targets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Targets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/patching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Patching
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sample-projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sample Projects
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parsing Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parsing Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-a-string" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a String
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supported Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspecting-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspecting Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patch-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        Patch Properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-by-file-type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtering by File Type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigating-to-files-and-hunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating to Files and Hunks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Applying Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dry-run-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dry Run Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-individual-files-or-hunks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Apply Individual Files or Hunks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generating Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-a-single-result" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a Single Result
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-batchresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a BatchResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        From a Transaction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saving Patches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reversing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reversing Patches
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-to-rejig-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Converting to Rejig Code
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Converting to Rejig Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smart-mode-vs-line-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Smart Mode vs Line Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-variable-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Variable Name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-python-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generating Python Scripts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generating Python Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saving Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#script-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generated-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Generated Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzing-patches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analyzing Patches
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyzing Patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detected-operation-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detected Operation Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#review-patches-before-applying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review Patches Before Applying
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-undo-patches-for-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Undo Patches for Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-code-changes-to-another-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migrate Code Changes to Another Branch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-patch-to-current-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compare Patch to Current State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-patches-for-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate Patches for CI/CD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="patching">Patching<a class="headerlink" href="#patching" title="Permanent link">&para;</a></h1>
<p>Rejig provides comprehensive support for working with unified diffs and git patches. You can parse patches, apply them, generate them from rejig operations, convert them to rejig code, and reverse them for undo operations.</p>
<h2 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rejig</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rejig</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># Load and apply a patch</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">file_count</span><span class="si">}</span><span class="s2">, +</span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_additions</span><span class="si">}</span><span class="s2">/-</span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_deletions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1"># Generate a patch from rejig operations</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">result</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="s2">&quot;Foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;Bar&quot;</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;rename.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># Reverse a patch (undo)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">undo</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">undo</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</code></pre></div>
<h2 id="parsing-patches">Parsing Patches<a class="headerlink" href="#parsing-patches" title="Permanent link">&para;</a></h2>
<h3 id="from-a-string">From a String<a class="headerlink" href="#from-a-string" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">diff_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="s2">--- a/models.py</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="s2">+++ b/models.py</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="s2">@@ -10,3 +10,4 @@ class User:</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="s2">     def __init__(self):</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="s2">         self.name = &quot;&quot;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="s2">+        self.email = &quot;&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">diff_text</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files affected: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">file_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lines added: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_additions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lines removed: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_deletions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="from-a-file">From a File<a class="headerlink" href="#from-a-file" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Load from patch file</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;bugfix.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1"># Returns empty patch if file doesn&#39;t exist (no exception)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;missing.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>  <span class="c1"># 0</span>
</code></pre></div>
<h3 id="supported-formats">Supported Formats<a class="headerlink" href="#supported-formats" title="Permanent link">&para;</a></h3>
<p>Rejig supports both unified diff and git diff formats:</p>
<p><strong>Unified Diff</strong> (from <code>diff -u</code>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="gd">--- a/file.py</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="gi">+++ b/file.py</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="gu">@@ -1,3 +1,4 @@</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w"> </span>line1
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="gi">+inserted</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w"> </span>line2
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w"> </span>line3
</code></pre></div></p>
<p><strong>Git Diff</strong> (from <code>git diff</code>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gh">diff --git a/file.py b/file.py</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="gh">index abc1234..def5678 100644</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="gd">--- a/file.py</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="gi">+++ b/file.py</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="gu">@@ -1,3 +1,4 @@</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w"> </span>line1
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="gi">+inserted</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w"> </span>line2
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w"> </span>line3
</code></pre></div></p>
<p>Git extended format features are fully supported:
- New file mode (<code>new file mode 100644</code>)
- Deleted file mode (<code>deleted file mode 100644</code>)
- Renames (<code>rename from</code>, <code>rename to</code>, <code>similarity index</code>)
- Mode changes (<code>old mode</code>, <code>new mode</code>)
- Binary file detection</p>
<h2 id="inspecting-patches">Inspecting Patches<a class="headerlink" href="#inspecting-patches" title="Permanent link">&para;</a></h2>
<h3 id="patch-properties">Patch Properties<a class="headerlink" href="#patch-properties" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Basic stats</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total files: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">file_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Additions: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_additions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deletions: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">total_deletions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="c1"># File paths affected</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="filtering-by-file-type">Filtering by File Type<a class="headerlink" href="#filtering-by-file-type" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># New files being added</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">new_files</span><span class="p">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New: </span><span class="si">{</span><span class="n">fp</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># Files being deleted</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">deleted_files</span><span class="p">:</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted: </span><span class="si">{</span><span class="n">fp</span><span class="o">.</span><span class="n">old_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># Files being renamed</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">renamed_files</span><span class="p">:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Renamed: </span><span class="si">{</span><span class="n">fp</span><span class="o">.</span><span class="n">old_path</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">fp</span><span class="o">.</span><span class="n">new_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># Files being modified (content only)</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">modified_files</span><span class="p">:</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modified: </span><span class="si">{</span><span class="n">fp</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="navigating-to-files-and-hunks">Navigating to Files and Hunks<a class="headerlink" href="#navigating-to-files-and-hunks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Iterate over file targets</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">for</span> <span class="n">file_target</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">files</span><span class="p">():</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">file_target</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  +</span><span class="si">{</span><span class="n">file_target</span><span class="o">.</span><span class="n">additions_count</span><span class="si">}</span><span class="s2">/-</span><span class="si">{</span><span class="n">file_target</span><span class="o">.</span><span class="n">deletions_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="c1"># Iterate over hunks</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="k">for</span> <span class="n">hunk</span> <span class="ow">in</span> <span class="n">file_target</span><span class="o">.</span><span class="n">hunks</span><span class="p">():</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  @@ </span><span class="si">{</span><span class="n">hunk</span><span class="o">.</span><span class="n">old_start</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">hunk</span><span class="o">.</span><span class="n">old_count</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">hunk</span><span class="o">.</span><span class="n">new_start</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">hunk</span><span class="o">.</span><span class="n">new_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="c1"># Look up specific file</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">file_target</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;src/models.py&quot;</span><span class="p">)</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="k">if</span> <span class="n">file_target</span><span class="p">:</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found changes to models.py&quot;</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="c1"># Look up specific hunk</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">first_hunk</span> <span class="o">=</span> <span class="n">file_target</span><span class="o">.</span><span class="n">hunk</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="k">if</span> <span class="n">first_hunk</span><span class="p">:</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First hunk starts at line </span><span class="si">{</span><span class="n">first_hunk</span><span class="o">.</span><span class="n">old_start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="getting-content">Getting Content<a class="headerlink" href="#getting-content" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Get hunk content</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">hunk</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;src/models.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hunk</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Original content (what was removed + context)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">old_content</span> <span class="o">=</span> <span class="n">hunk</span><span class="o">.</span><span class="n">get_old_content</span><span class="p">()</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># New content (what was added + context)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="n">new_content</span> <span class="o">=</span> <span class="n">hunk</span><span class="o">.</span><span class="n">get_new_content</span><span class="p">()</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1"># Full patch as unified diff</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">diff_text</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_unified_diff</span><span class="p">()</span>
</code></pre></div>
<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Get a human-readable summary</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1"># Patch: 3 file(s)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1">#   +42/-15 lines</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1">#   New: 1</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1">#   Modified: 2</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c1"># Files:</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1">#   src/new_module.py (new): +30/-0</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="c1">#   src/models.py: +10/-5</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1">#   src/utils.py: +2/-10</span>
</code></pre></div>
<h2 id="applying-patches">Applying Patches<a class="headerlink" href="#applying-patches" title="Permanent link">&para;</a></h2>
<h3 id="basic-apply">Basic Apply<a class="headerlink" href="#basic-apply" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># Apply all changes</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applied to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">files_changed</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="dry-run-mode">Dry Run Mode<a class="headerlink" href="#dry-run-mode" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># Preview what would happen</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>  <span class="c1"># Shows diff without writing files</span>
</code></pre></div>
<h3 id="apply-individual-files-or-hunks">Apply Individual Files or Hunks<a class="headerlink" href="#apply-individual-files-or-hunks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1"># Apply only changes to a specific file</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">file_target</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;src/models.py&quot;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">if</span> <span class="n">file_target</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">file_target</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1"># Apply a specific hunk (use with caution - line numbers may shift)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">hunk</span> <span class="o">=</span> <span class="n">file_target</span><span class="o">.</span><span class="n">hunk</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">result</span> <span class="o">=</span> <span class="n">hunk</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</code></pre></div>
<h2 id="generating-patches">Generating Patches<a class="headerlink" href="#generating-patches" title="Permanent link">&para;</a></h2>
<h3 id="from-a-single-result">From a Single Result<a class="headerlink" href="#from-a-single-result" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># Perform an operation</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">result</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="s2">&quot;OldName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;NewName&quot;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1"># Generate a patch from the result</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;rename.patch&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="from-a-batchresult">From a BatchResult<a class="headerlink" href="#from-a-batchresult" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># Perform batch operations</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">batch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">find_classes</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;^Test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_decorator</span><span class="p">(</span><span class="s2">&quot;pytest.mark.slow&quot;</span><span class="p">)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># Generate patch from all changes</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="nb">print</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</code></pre></div>
<h3 id="from-a-transaction">From a Transaction<a class="headerlink" href="#from-a-transaction" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">with</span> <span class="n">rj</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">rj</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="s2">&quot;Foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;Bar&quot;</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">rj</span><span class="o">.</span><span class="n">find_function</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_decorator</span><span class="p">(</span><span class="s2">&quot;cache&quot;</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">rj</span><span class="o">.</span><span class="n">find_method</span><span class="p">(</span><span class="s2">&quot;process&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">)</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="c1"># Generate patch from transaction (before commit)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;refactoring.patch&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="saving-patches">Saving Patches<a class="headerlink" href="#saving-patches" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c1"># Save to file</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved to </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">files_changed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1"># Overwrite existing file</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output.patch&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="c1"># Get as string instead of saving</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="n">diff_text</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_unified_diff</span><span class="p">()</span>
</code></pre></div>
<h2 id="reversing-patches">Reversing Patches<a class="headerlink" href="#reversing-patches" title="Permanent link">&para;</a></h2>
<p>Create a reversed patch to undo changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Load original patch</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># Create reversed version</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">undo_patch</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># Apply to undo the original changes</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="n">result</span> <span class="o">=</span> <span class="n">undo_patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="c1"># Or save for later</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="n">undo_patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;undo-changes.patch&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Reversal works at all levels:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Reverse entire patch</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">undo_patch</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># Reverse a specific file&#39;s changes</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">undo_file</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;models.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># Reverse a specific hunk</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">undo_hunk</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;models.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hunk</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</code></pre></div>
<h2 id="converting-to-rejig-code">Converting to Rejig Code<a class="headerlink" href="#converting-to-rejig-code" title="Permanent link">&para;</a></h2>
<p>Convert a patch to equivalent rejig Python code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1"># Generate rejig code</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">code</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_rejig_code</span><span class="p">()</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1"># Output might be:</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="c1"># rj.file(&quot;src/models.py&quot;).find_class(&quot;OldName&quot;).rename(&quot;NewName&quot;)</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># rj.file(&quot;src/utils.py&quot;).lines(10, 15).rewrite(&quot;...&quot;)</span>
</code></pre></div>
<h3 id="smart-mode-vs-line-mode">Smart Mode vs Line Mode<a class="headerlink" href="#smart-mode-vs-line-mode" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Smart mode (default): Detects high-level operations</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">code</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_rejig_code</span><span class="p">(</span><span class="n">smart_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1"># Output: rj.file(&quot;src/models.py&quot;).find_class(&quot;Foo&quot;).rename(&quot;Bar&quot;)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1"># Line mode: Always uses line-based operations (more reliable)</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">code</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_rejig_code</span><span class="p">(</span><span class="n">smart_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1"># Output: rj.file(&quot;src/models.py&quot;).lines(10, 15).rewrite(&quot;...&quot;)</span>
</code></pre></div>
<h3 id="custom-variable-name">Custom Variable Name<a class="headerlink" href="#custom-variable-name" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">code</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_rejig_code</span><span class="p">(</span><span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;refactor&quot;</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># Output: refactor.file(&quot;src/models.py&quot;).find_class(&quot;Foo&quot;).rename(&quot;Bar&quot;)</span>
</code></pre></div>
<h2 id="generating-python-scripts">Generating Python Scripts<a class="headerlink" href="#generating-python-scripts" title="Permanent link">&para;</a></h2>
<p>Convert a patch to a complete, executable Python script that applies the changes using rejig operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c1"># Generate a complete Python script</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">script</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_script</span><span class="p">()</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</code></pre></div>
<p>The generated script includes:
- Shebang line (<code>#!/usr/bin/env python3</code>)
- Module docstring with patch metadata
- Imports
- Patch summary as comments
- Main function with error handling
- Standard <code>if __name__ == "__main__"</code> block</p>
<h3 id="saving-scripts">Saving Scripts<a class="headerlink" href="#saving-scripts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># Save the script directly to a file</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">save_script</span><span class="p">(</span><span class="s2">&quot;apply_changes.py&quot;</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Script saved to </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">files_changed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="c1"># Overwrite existing file</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">save_script</span><span class="p">(</span><span class="s2">&quot;apply_changes.py&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The saved script is automatically made executable.</p>
<h3 id="script-options">Script Options<a class="headerlink" href="#script-options" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Full control over script generation</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">script</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_script</span><span class="p">(</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;refactor&quot;</span><span class="p">,</span>       <span class="c1"># Name for Rejig instance</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span>               <span class="c1"># Root path in the script</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Apply bugfix&quot;</span><span class="p">,</span>     <span class="c1"># Custom docstring description</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                   <span class="c1"># Generate dry-run mode script</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="n">smart_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>               <span class="c1"># Use line-based operations</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="n">include_error_handling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>    <span class="c1"># Include result checking</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="n">include_summary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>           <span class="c1"># Include patch summary comments</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="p">)</span>
</code></pre></div>
<h3 id="example-generated-script">Example Generated Script<a class="headerlink" href="#example-generated-script" title="Permanent link">&para;</a></h3>
<p>For a simple rename patch, the generated script looks like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="sd">Apply bugfix</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="sd">Generated from patch: +5/-3 lines</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rejig</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rejig</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="c1"># Patch Summary</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="c1"># Files: 1</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="c1"># Additions: +5</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="c1"># Deletions: -3</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="c1">#   src/models.py: +5/-3</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply the patch changes.&quot;&quot;&quot;</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>    <span class="c1"># Apply changes</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;src/models.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="s2">&quot;OldName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;NewName&quot;</span><span class="p">)</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>    <span class="c1"># Report results</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>    <span class="n">success_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>    <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed: </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_count</span><span class="si">}</span><span class="s2"> operations succeeded&quot;</span><span class="p">)</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>    <span class="k">if</span> <span class="n">success_count</span> <span class="o">&lt;</span> <span class="n">total_count</span><span class="p">:</span>
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>        <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">success</span><span class="p">]</span>
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">:</span>
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failed: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<p><strong>Share refactoring as executable script:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Generate a script that teammates can run</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;migration.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">patch</span><span class="o">.</span><span class="n">save_script</span><span class="p">(</span><span class="s2">&quot;run_migration.py&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Database model migration&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Create dry-run preview scripts:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Generate a script that previews changes without applying</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">patch</span><span class="o">.</span><span class="n">save_script</span><span class="p">(</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="s2">&quot;preview_changes.py&quot;</span><span class="p">,</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Preview the refactoring changes&quot;</span><span class="p">,</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="p">)</span>
</code></pre></div></p>
<p><strong>Generate scripts for CI/CD:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Generate a script for automated pipelines</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">patch</span><span class="o">.</span><span class="n">save_script</span><span class="p">(</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="s2">&quot;apply_in_ci.py&quot;</span><span class="p">,</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{PROJECT_ROOT}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="n">include_error_handling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">)</span>
</code></pre></div></p>
<h2 id="analyzing-patches">Analyzing Patches<a class="headerlink" href="#analyzing-patches" title="Permanent link">&para;</a></h2>
<p>Detect what operations a patch represents:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rejig.patching</span><span class="w"> </span><span class="kn">import</span> <span class="n">OperationType</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;changes.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1"># Get detected operations</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">operations</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  File: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Confidence: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">confidence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="detected-operation-types">Detected Operation Types<a class="headerlink" href="#detected-operation-types" title="Permanent link">&para;</a></h3>
<p>The analyzer can detect:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CLASS_ADD</code></td>
<td>New class definition added</td>
</tr>
<tr>
<td><code>CLASS_DELETE</code></td>
<td>Class definition removed</td>
</tr>
<tr>
<td><code>CLASS_RENAME</code></td>
<td>Class renamed (detected from paired add/delete)</td>
</tr>
<tr>
<td><code>FUNCTION_ADD</code></td>
<td>New module-level function added</td>
</tr>
<tr>
<td><code>FUNCTION_DELETE</code></td>
<td>Module-level function removed</td>
</tr>
<tr>
<td><code>FUNCTION_RENAME</code></td>
<td>Function renamed</td>
</tr>
<tr>
<td><code>METHOD_ADD</code></td>
<td>New method added to a class</td>
</tr>
<tr>
<td><code>METHOD_DELETE</code></td>
<td>Method removed from a class</td>
</tr>
<tr>
<td><code>METHOD_RENAME</code></td>
<td>Method renamed</td>
</tr>
<tr>
<td><code>DECORATOR_ADD</code></td>
<td>Decorator added</td>
</tr>
<tr>
<td><code>DECORATOR_REMOVE</code></td>
<td>Decorator removed</td>
</tr>
<tr>
<td><code>IMPORT_ADD</code></td>
<td>Import statement added</td>
</tr>
<tr>
<td><code>IMPORT_REMOVE</code></td>
<td>Import statement removed</td>
</tr>
<tr>
<td><code>LINE_REWRITE</code></td>
<td>Lines replaced with new content</td>
</tr>
<tr>
<td><code>LINE_INSERT</code></td>
<td>Lines inserted</td>
</tr>
<tr>
<td><code>LINE_DELETE</code></td>
<td>Lines deleted</td>
</tr>
<tr>
<td><code>FILE_CREATE</code></td>
<td>New file created</td>
</tr>
<tr>
<td><code>FILE_DELETE</code></td>
<td>File deleted</td>
</tr>
<tr>
<td><code>FILE_RENAME</code></td>
<td>File renamed</td>
</tr>
</tbody>
</table>
<h2 id="use-cases_1">Use Cases<a class="headerlink" href="#use-cases_1" title="Permanent link">&para;</a></h2>
<h3 id="review-patches-before-applying">Review Patches Before Applying<a class="headerlink" href="#review-patches-before-applying" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">review_and_apply</span><span class="p">(</span><span class="n">patch_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="n">patch_path</span><span class="p">)</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>    <span class="c1"># Show summary</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>    <span class="c1"># Show detected operations</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">analyze</span><span class="p">():</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="c1"># Show full diff</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">to_unified_diff</span><span class="p">())</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="c1"># Confirm</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>    <span class="k">if</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Apply? [y/N] &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applied: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="create-undo-patches-for-safety">Create Undo Patches for Safety<a class="headerlink" href="#create-undo-patches-for-safety" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">safe_refactor</span><span class="p">(</span><span class="n">rj</span><span class="p">:</span> <span class="n">Rejig</span><span class="p">):</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>    <span class="k">with</span> <span class="n">rj</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>        <span class="c1"># Perform changes</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>        <span class="n">rj</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="s2">&quot;OldAPI&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;NewAPI&quot;</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>        <span class="n">rj</span><span class="o">.</span><span class="n">find_function</span><span class="p">(</span><span class="s2">&quot;deprecated_helper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>        <span class="c1"># Generate both forward and reverse patches</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>        <span class="n">forward_patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>        <span class="n">undo_patch</span> <span class="o">=</span> <span class="n">forward_patch</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>        <span class="c1"># Save undo patch BEFORE committing</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>        <span class="n">undo_patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;undo-refactor.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>        <span class="c1"># Now commit</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>        <span class="n">tx</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>        <span class="n">forward_patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;refactor.patch&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="migrate-code-changes-to-another-branch">Migrate Code Changes to Another Branch<a class="headerlink" href="#migrate-code-changes-to-another-branch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># On feature branch: capture changes as patch</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">find_classes</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;^Legacy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;^Legacy&quot;</span><span class="p">,</span> <span class="s2">&quot;Modern&quot;</span><span class="p">)</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;migration.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="c1"># On target branch: apply the patch</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="s2">&quot;migration.patch&quot;</span><span class="p">)</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="n">result</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</code></pre></div>
<h3 id="compare-patch-to-current-state">Compare Patch to Current State<a class="headerlink" href="#compare-patch-to-current-state" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_patch_applicability</span><span class="p">(</span><span class="n">patch_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>    <span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">patch_from_file</span><span class="p">(</span><span class="n">patch_path</span><span class="p">)</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    <span class="k">for</span> <span class="n">file_target</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">files</span><span class="p">():</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">file_target</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>        <span class="k">if</span> <span class="n">file_target</span><span class="o">.</span><span class="n">is_new</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Would create </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> but it already exists&quot;</span><span class="p">)</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>        <span class="k">elif</span> <span class="n">file_target</span><span class="o">.</span><span class="n">is_deleted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Would delete </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> but it doesn&#39;t exist&quot;</span><span class="p">)</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">file_target</span><span class="o">.</span><span class="n">is_new</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Would modify </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> but it doesn&#39;t exist&quot;</span><span class="p">)</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>    <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential issues:&quot;</span><span class="p">)</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>        <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Patch appears applicable&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="generate-patches-for-cicd">Generate Patches for CI/CD<a class="headerlink" href="#generate-patches-for-cicd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_migration_patch</span><span class="p">():</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a patch for code migration, suitable for CI review.&quot;&quot;&quot;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="n">rj</span> <span class="o">=</span> <span class="n">Rejig</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="k">with</span> <span class="n">rj</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>        <span class="c1"># Modernize type hints</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>        <span class="n">rj</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="s2">&quot;**/*.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">modernize_type_hints</span><span class="p">()</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>        <span class="c1"># Update deprecated APIs</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">rj</span><span class="o">.</span><span class="n">find_functions</span><span class="p">():</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>            <span class="k">if</span> <span class="s2">&quot;oldapi&quot;</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>                <span class="n">func</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;oldapi&quot;</span><span class="p">,</span> <span class="s2">&quot;newapi&quot;</span><span class="p">))</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>        <span class="c1"># Generate patch</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>        <span class="n">patch</span> <span class="o">=</span> <span class="n">rj</span><span class="o">.</span><span class="n">generate_patch</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>        <span class="c1"># Add metadata</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;# Auto-generated migration patch</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="s2"># Generated: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="s2"># Operations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">analyze</span><span class="p">())</span><span class="si">}</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="s2"># Files affected: </span><span class="si">{</span><span class="n">patch</span><span class="o">.</span><span class="n">file_count</span><span class="si">}</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;migration.patch&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">to_unified_diff</span><span class="p">())</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Always use dry_run for patch generation</strong>: This ensures you see what would change without modifying files.</p>
</li>
<li>
<p><strong>Save undo patches before applying</strong>: In case something goes wrong, you have a way to revert.</p>
</li>
<li>
<p><strong>Review patches before applying</strong>: Use <code>patch.summary()</code> and <code>patch.analyze()</code> to understand changes.</p>
</li>
<li>
<p><strong>Use transactions for complex changes</strong>: Generate patches from transactions for atomic, reviewable changes.</p>
</li>
<li>
<p><strong>Prefer smart_mode=False for reliability</strong>: Line-based operations are more predictable than detected operations.</p>
</li>
<li>
<p><strong>Check file existence before applying</strong>: Patches may fail if expected files don't exist or have changed.</p>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>